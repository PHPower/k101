# 项目实践

本次课程是一节实践课，在这次课程中，我们利用前面学到的知识部署两个微服务到 Kubernetes 集群中。主要是带大家一起回归一下 deployment、configmap、secret、service 这些资源如何配合使用。

本次部署微服务如下图所示：

![微服务架构](https://github.com/findsec-cn/k100/raw/master/docs/micoservice.jpg)

## 项目部署

### 部署

    kubectl apply -f project/

### 获取pods

    kubectl get pods
    NAME                        READY   STATUS    RESTARTS   AGE
    auth-7fd44dbc5b-klz9k       1/1     Running   0          108s
    frontend-84794db478-2wqrk   1/1     Running   0          108s
    hello-9944bc998-wgq88       1/1     Running   0          107s

### 登录虚拟机

    minikube ssh

## 拷贝ca.pem到虚拟机上

### 访问非授权接口返回成功

    curl --cacert ./ca.pem https://127.0.0.1:30443/hello
    {"message":"Hello"}

### 访问非授权接口返回失败

    curl --cacert ./ca.pem https://127.0.0.1:30443/secure
    authorization failed

### 获取接口JWT Token

    curl --cacert ./ca.pem -u user https://127.0.0.1:30443/login
    Enter host password for user 'user':password
    {"token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJlbWFpbCI6InVzZXJAZXhhbXBsZS5jb20iLCJleHAiOjE1NDcyNzg4NjcsImlhdCI6MTU0NzAxOTY2NywiaXNzIjoiYXV0aC5zZXJ2aWNlIiwic3ViIjoidXNlciJ9.bT3flMe_VywoFkGCFt08Tw0fxytKZblj8lBHNVLYC6U"}

### 使用Token访问接口成功返回

    curl --cacert ./ca.pem -H 'Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJlbWFpbCI6InVzZXJAZXhhbXBsZS5jb20iLCJleHAiOjE1NDcyNzg4NjcsImlhdCI6MTU0NzAxOTY2NywiaXNzIjoiYXV0aC5zZXJ2aWNlIiwic3ViIjoidXNlciJ9.bT3flMe_VywoFkGCFt08Tw0fxytKZblj8lBHNVLYC6U' https://127.0.0.1:30443/secure
